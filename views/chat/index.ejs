<%- include('../partials/head', { pageTitle, hotelName, csrfToken, darkMode }) %>
<%- include('../partials/nav') %>
<%- include('../partials/alerts') %>

<section
  class="chat-layout"
  data-animate="fade-up"
  data-current-user="<%= currentUser.id %>"
  data-active-room="lobby"
  data-active-dm=""
  data-encryption-key="<%= encryptionKey %>"
  data-reaction-set='<%= JSON.stringify(reactions || []) %>'
>
  <aside class="chat-sidebar">
    <div class="chat-section">
      <h2>Rooms</h2>
      <ul class="chat-room-list" data-room-list>
        <li><button type="button" data-room="lobby" class="active">Lobby</button></li>
        <% stayRooms.forEach(function(room) { %>
          <li><button type="button" data-room="<%= room.id %>">Stay <%= room.label %></button></li>
        <% }) %>
      </ul>
    </div>
    <div class="chat-section">
      <h2>Direct messages</h2>
      <div class="chat-search">
        <label for="chat-user-search" class="sr-only">Search users</label>
        <input
          id="chat-user-search"
          type="search"
          placeholder="Search guests & staff"
          autocomplete="off"
          data-user-search
        />
        <ul class="chat-search-results" data-search-results hidden></ul>
      </div>
      <p class="chat-empty" data-empty-dm <%= (recentContacts && recentContacts.length) ? 'hidden' : '' %>>
        Start a new conversation by searching for a guest or team member.
      </p>
      <ul class="chat-dm-list" data-dm-list>
        <% const dmSource = (recentContacts && recentContacts.length) ? recentContacts.map(function(entry) { return entry.user; }) : users; %>
        <% dmSource.forEach(function(user) { %>
          <li>
            <button type="button" data-dm="<%= user.id %>" data-display-name="<%= user.name %>">
              <span class="presence-indicator" data-presence-indicator="<%= user.id %>"></span>
              <%= user.name %>
            </button>
          </li>
        <% }) %>
      </ul>
    </div>
  </aside>
  <div class="chat-main">
    <header class="chat-header">
      <div class="chat-header-meta">
        <h1 data-active-channel>Lobby</h1>
        <span class="chat-status is-offline" data-chat-status>Connectingâ€¦</span>
      </div>
      <div class="typing-indicator" data-typing hidden></div>
    </header>
    <div class="chat-history" data-messages role="log" aria-live="polite"></div>
    <div class="chat-suggestions" data-suggestions hidden>
      <div class="chat-suggestions-header">
        <h2>Suggested replies</h2>
        <span data-sentiment-label></span>
      </div>
      <div class="chat-suggestions-list" data-suggestion-list></div>
    </div>
    <form class="chat-composer" data-chat-form>
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <div class="chat-composer-controls">
        <label class="chat-upload" data-file-trigger>
          <span aria-hidden="true">ðŸ“Ž</span>
          <span class="sr-only">Attach a file</span>
          <input type="file" name="attachment" data-file-input />
        </label>
        <textarea name="message" placeholder="Send a message" rows="2" maxlength="400"></textarea>
      </div>
      <div class="chat-composer-actions">
        <span class="chat-file-indicator" data-file-indicator hidden>No file selected</span>
        <button class="cta-button primary" type="submit">Send</button>
      </div>
    </form>
  </div>
</section>

<script defer src="/js/chat.js"></script>
<%- include('../partials/footer') %>
