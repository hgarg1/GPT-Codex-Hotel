<%- include('../partials/head', { pageTitle, hotelName, csrfToken, darkMode }) %>
<%- include('../partials/nav') %>
<%- include('../partials/alerts') %>
<section class="dashboard" data-animate="fade-up">
  <div class="dashboard-intro">
    <h1>Welcome, <%= currentUser.name %></h1>
    <p>Manage your voyages, refine your profile, and prepare for your next orbit at <%= hotelName %>.</p>
  </div>
  <div class="dashboard-grid">
    <section class="dashboard-panel">
      <h2>Your Bookings</h2>
      <% if (!bookings.length) { %>
        <p>You have no active bookings yet. Explore our <a href="/rooms">futuristic suites</a> to begin.</p>
      <% } else { %>
        <ul class="booking-list">
          <% bookings.forEach(function(booking) { %>
            <li class="booking-item">
              <div>
                <h3><%= booking.roomName %></h3>
                <p><strong><%= new Date(booking.startDate).toLocaleDateString('en-US') %></strong> → <strong><%= new Date(booking.endDate).toLocaleDateString('en-US') %></strong> · <%= booking.guests %> guests</p>
                <p>Status: <span class="status <%= booking.status %>"><%= booking.status %></span></p>
                <p>Total: ₵<%= booking.totalCost %> for <%= booking.nights %> night(s)</p>
              </div>
              <% if (booking.status !== 'cancelled') { %>
                <form action="/bookings/<%= booking.id %>/cancel" method="post">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                  <button type="submit" class="cta-button">Cancel</button>
                </form>
              <% } else { %>
                <p class="cancelled-note">Cancelled at <%= new Date(booking.cancelledAt).toLocaleString('en-US') %></p>
              <% } %>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </section>
    <section class="dashboard-panel">
      <h2>Profile</h2>
      <form action="/profile" method="post" class="profile-form">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
        <label for="profile-name">Name</label>
        <input type="text" id="profile-name" name="name" value="<%= currentUser.name %>" required />
        <label for="profile-bio">Bio</label>
        <textarea id="profile-bio" name="bio" rows="4"><%= currentUser.profile?.bio || '' %></textarea>
        <label for="profile-phone">Comms Channel</label>
        <input type="text" id="profile-phone" name="phone" value="<%= currentUser.profile?.phone || '' %>" />
        <button type="submit" class="cta-button primary">Update Profile</button>
      </form>
    </section>
  </div>
</section>
<%- include('../partials/footer') %>
